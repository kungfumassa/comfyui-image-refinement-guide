import React, { useEffect, useMemo, useRef, useState } from "react";
<div className="space-y-2">
<Label>Negative Prompt</Label>
<Textarea rows={3} value={negative} onChange={(e)=>setNegative(e.target.value)} />
</div>
<div className="flex items-center justify-between">
<div className="flex items-center gap-2">
<Label>Goal</Label>
<Tabs value={goal} onValueChange={setGoal}>
<TabsList>
<TabsTrigger value="portrait">Portrait</TabsTrigger>
<TabsTrigger value="widescreen">Widescreen</TabsTrigger>
<TabsTrigger value="square">Square</TabsTrigger>
</TabsList>
</Tabs>
</div>
{model === "FLUX" && (
<div className="flex items-center gap-3">
<Label className="text-xs">Guidance</Label>
<div className="w-28"><Slider defaultValue={[guidance]} min={2.5} max={8} step={0.5} onValueChange={(v)=>setGuidance(v[0])} /></div>
<Badge variant="outline">{guidance.toFixed(1)}</Badge>
</div>
)}
</div>
<Separator className="my-2" />
<div className="space-y-2">
<Label>Positive Prompt</Label>
<Textarea readOnly rows={4} value={builtPrompt} />
<CopyButton text={builtPrompt} />
</div>
<div className="space-y-2">
<Label>Recommended Settings</Label>
<div className="rounded-xl border border-slate-800 p-3 text-xs space-y-1 bg-slate-950/50">
<div>Model: <b>{model}</b></div>
<div>Sampler: <b>{settingHint.sampler}</b></div>
<div>Steps: <b>{settingHint.steps}</b> {model === "FLUX" ? `(CFG=1, guidance ~${settingHint.guidance || 4.5})` : `(CFG ≈ ${settingHint.cfg})`}</div>
<div>Canvas: <b>{settingHint.size}</b></div>
<div>Refine: <b>{settingHint.refine}</b></div>
</div>
</div>
</CardContent>
</Card>
</aside>


{/* Main content */}
<main ref={contentRef} className="space-y-6">
<SectionBase />
<SectionRefine />
<SectionTargeted />
<SectionWorkflows />
<SectionBest />
<footer className="py-6 text-center text-xs text-slate-400">Built for ComfyUI creators. Tailwind + shadcn/ui • Interactive guide • On-page AI assistant</footer>
</main>
</div>


{/* Floating Assistant */}
<div className="fixed bottom-6 right-6 z-50 flex flex-col items-end gap-3">
{openAssistant && (
<Card className="w-[min(92vw,420px)] shadow-2xl border-emerald-600/30">
<CardHeader className="pb-2">
<CardTitle className="flex items-center gap-2 text-base"><Bot className="h-5 w-5 text-emerald-400"/> Comfy Assistant</CardTitle>
<CardDescription>Generate prompts • Recommend samplers • Plan refinements</CardDescription>
</CardHeader>
<CardContent>
<div className="h-64 overflow-y-auto rounded-lg border border-slate-800 p-3 bg-slate-950/50 space-y-3">
{chat.map((m, i) => (
<div key={i} className={cx("text-sm", m.role === "assistant" ? "text-slate-100" : "text-slate-300") }>
<div className="text-xs uppercase tracking-wide mb-1 text-slate-400">{m.role}</div>
<pre className="whitespace-pre-wrap leading-6">{m.text}</pre>
</div>
))}
</div>
<div className="mt-3 flex gap-2">
<Input placeholder="Ask for a prompt, sampler, or step plan…" value={msg} onChange={(e)=>setMsg(e.target.value)} onKeyDown={(e)=> e.key === 'Enter' && handleSend()} />
<Button onClick={handleSend} className="gap-2"><Send className="h-4 w-4"/>Send</Button>
</div>
<div className="mt-2 text-[11px] text-slate-400">Tip: try “generate prompt for cyberpunk alley portrait”, “sampler for SDXL face refine”, or “node graph for FLUX”.</div>
</CardContent>
</Card>
)}
<Button size="lg" className="rounded-full h-12 w-12 p-0 shadow-lg bg-emerald-600 hover:bg-emerald-500" onClick={()=>setOpenAssistant(s=>!s)}>
<Bot className="h-5 w-5"/>
</Button>
</div>
</div>
</TooltipProvider>
);
}


// =========================================================
// Small Flow Diagram component
// =========================================================
function FlowDiagram({ nodes }) {
return (
<div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
{nodes.map((n, i) => (
<div key={i} className="flex items-center justify-between rounded-xl border border-slate-800 bg-slate-950/50 px-3 py-2 text-sm">
<span>{n}</span>
{i < nodes.length - 1 && <ChevronRight className="h-4 w-4 text-slate-500"/>}
</div>
))}
</div>
);
}
